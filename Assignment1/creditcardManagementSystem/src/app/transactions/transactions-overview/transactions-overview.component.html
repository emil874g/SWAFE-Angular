<div class="transactions-container">
  <div class="header">
    <h1>Transactions</h1>
    <button class="btn btn-primary" (click)="toggleAddForm()">
      {{ showAddForm() ? 'Cancel' : 'Add Transaction' }}
    </button>
  </div>

  @if (showAddForm()) {
    <div class="add-transaction-form">
      <h2>Add New Transaction</h2>
      <form (ngSubmit)="addTransaction()">
        <div class="form-group">
          <label for="creditCardId">Credit Card *</label>
          <select
            id="creditCardId"
            name="creditCardId"
            [(ngModel)]="newTransaction.creditCardId"
            class="form-control"
            required
          >
            <option value="0">Select a credit card</option>
            @for (card of creditCards(); track card.id) {
              <option [value]="card.id">{{ card.card_number }} - {{ card.cardholder_name }}</option>
            }
          </select>
          @if (errors['creditCardId']) {
            <span class="error-text">{{ errors['creditCardId'] }}</span>
          }
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="amount">Amount *</label>
            <input
              type="number"
              id="amount"
              name="amount"
              [(ngModel)]="newTransaction.amount"
              class="form-control"
              step="0.01"
              required
            />
            @if (errors['amount']) {
              <span class="error-text">{{ errors['amount'] }}</span>
            }
          </div>

          <div class="form-group">
            <label for="currency">Currency *</label>
            <select
              id="currency"
              name="currency"
              [(ngModel)]="newTransaction.currency"
              class="form-control"
              required
            >
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="DKK">DKK</option>
            </select>
            @if (errors['currency']) {
              <span class="error-text">{{ errors['currency'] }}</span>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="date">Date *</label>
          <input
            type="date"
            id="date"
            name="date"
            [(ngModel)]="newTransaction.date"
            class="form-control"
            required
          />
          @if (errors['date']) {
            <span class="error-text">{{ errors['date'] }}</span>
          }
        </div>

        <div class="form-group">
          <label for="comment">Comment</label>
          <textarea
            id="comment"
            name="comment"
            [(ngModel)]="newTransaction.comment"
            class="form-control"
            rows="3"
            placeholder="Enter transaction description"
          ></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="toggleAddForm()">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Transaction</button>
        </div>
      </form>
    </div>
  }

  <div class="filter-section">
    <h2>Filter Transactions</h2>
    <div class="filter-controls">
      <input
        type="text"
        [(ngModel)]="filterCardNumber"
        placeholder="Filter by card number"
        class="form-control"
        (input)="filterTransactions()"
      />
      <button class="btn btn-secondary" (click)="clearFilter()">Clear Filter</button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading">Loading transactions...</div>
  } @else {
    <app-transactions-list 
      [transactions]="filteredTransactions()" 
      (transactionDeleted)="onTransactionDeleted()">
    </app-transactions-list>
  }
</div>
